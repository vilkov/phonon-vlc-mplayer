#summary How to build and install phonon-vlc-mplayer
#labels Featured,Phase-Requirements,Phase-Deploy

=Introduction=

This document explains how to build and install phonon-vlc-mplayer under Windows and GNU/Linux.

=Requirements=

 * OS: GNU/Linux, Windows
 * Tested under: Windows XP SP2, Ubuntu Hardy 8.04
 * Language: C++
 * License: GNU LGPL
 * Dependencies:
   * Qt: >= Qt-4.4.0 RC1 (or KDE-4.1 SVN)
      * Website: http://trolltech.com/
      * Download link: ftp://ftp.trolltech.com/qt/source/
   * Phonon: >= Phonon KDE 4.1 SVN
      * Website: 
   * CMake: >= CMake-2.4.8
      * Website: http://cmake.org/
      * Download link: http://cmake.org/HTML/Download.html
   * Compiler: GCC or Visual C++ 2005 (MSVC8)

==GNU/Linux==

If Qt-4.4 is not present on your distribution (libqt4-devel packages), you will have to compile Qt-4.4.
Qt-4.4 needs to be configured with Phonon support.
Please refer to the links above for downloading and installing Qt-4.4

==MinGW==

I didn't test compiling phonon-vlc-mplayer with MinGW, however it should work fine.

 * Install Qt-4.4 RC1 compiled for MinGW: [ftp://ftp.trolltech.com/qt/source/qt-win-opensource-4.4.0-rc1-mingw.exe qt-win-opensource-4.4.0-rc1-mingw.exe]

Qt-4.4 RC1 already contains a simple way to install MinGW.
Be aware that MinGW version of Qt-4.4 does not come with Phonon. This is not an issue since you need to compile Phonon SVN anyway.

(For the little story, the default Windows backend for Phonon is based on DirectShow 9 and MinGW is not capable of compiling DS9 code,
that's why Trolltech doesn't ship Phonon with Qt-4.4 MinGW)

==Visual C++ 2005 (MSVC8)==

(Informations taken from [http://techbase.kde.org/index.php?title=Getting_Started/Build/KDE4/Windows/MS_Visual_Studio#Visual_Studio_2005_Express_Edition KDE TechBase])

If you want to compile phonon-vlc-mplayer under Windows, you need to install Microsoft Visual Studio 2005 Express Edition (or whatever edition of Visual C++ 2005/2008).
Warning: the whole process is quite long and uneasy.

 * Install Visual C++ 2005 Express Edition: http://www.microsoft.com/express/2005/download/default.aspx
 * Install Platform SDK: [http://www.microsoft.com/downloads/details.aspx?FamilyID=0baf2b35-c656-4969-ace8-e4c0c0716adb&DisplayLang=en link]
 * Install Service Pack 1 for Visual C++ 2005 Express Edition (probably not needed, please tell me if it works without): [http://www.microsoft.com/downloads/details.aspx?FamilyID=7b0b0339-613a-46e6-ab4d-080d4d4a8c4e&DisplayLang=en link]
 * Install DirectX SDK (probably not needed, please tell me if it works without): [http://www.microsoft.com/downloads/details.aspx?FamilyId=572BE8A6-263A-4424-A7FE-69CFF1A5B180&displaylang=en link]
 * Install CMake (see links above)

You need to setup you compiling environment, I use this small script: [http://code.google.com/p/phonon-vlc-mplayer/source/browse/wiki/setenv.bat setenv.bat].
Adapt and save this script to a {{{setenv.bat}}} file to fit your own needs. You have to run it from a 'Command prompt' each time you want to compile something using Visual C++ 2005.

When all this is done properly, you will be able to compile Qt-4.4 (see links above) and then phonon-vlc-mplayer.
(Unfortunately, Qt-4.4 Windows binaries have not been yet released on the website: http://qt.windows.binaries.googlepages.com/index.html)

==MacOS X==

I didn't try phonon-vlc-mplayer under MacOS X (I don't have an Apple computer).
However, VLC and MPlayer run under MacOS X and 99% of phonon-vlc-mplayer source code is multiplatform and depends only on Qt. I guess you will need to modify CMakeLists.txt files.

==Compiling the latest Phonon library==

If you use KDE-4.1 SVN, then you have the latest Phonon library.
Qt-4.4 contains an old version of Phonon, you need Phonon SVN (I use rev799484) in order to compile phonon-vlc-mplayer.

Here is a way to patch Qt-4.4 source code using latest Phonon SVN, it is a bit complex but not very long.

 * Get latest Phonon SVN: {{{svn co svn://anonsvn.kde.org/home/kde/trunk/KDE/kdelibs/phonon phonon}}}
 * Patch Qt-4.4:
   * Copy [http://code.google.com/p/phonon-vlc-mplayer/source/browse/wiki/phonon.pro phonon.pro] to the directory {{{$QTDIR/src/phonon}}}
   * Copy Phonon SVN sources inside the directory {{{$QTDIR/src/3rdparty/kdelibs/phonon}}}
   * Copy Phonon SVN headers inside the directory {{{$QTDIR/include/phonon}}}
   * Compile Qt-4.4

Compiled Phonon files (*.dll, *.lib, *.pdb) should be located inside {{{$QTDIR/bin}}} and {{{$QTDIR/lib}}}

==VLC Phonon backend==

 * Dependencies
   * Same as above +
   * VLC: VLC-0.9 (git trunk)
      * Website: http://www.videolan.org/
      * Developers infos: http://wiki.videolan.org/Developers_Corner
      * Download link: http://nightlies.videolan.org/

VLC Phonon backend uses libvlc (http://wiki.videolan.org/Libvlc) in order to control VLC.
It currently works under Windows and Linux by loading libvlc-control.(dll|so) at runtime.
Install a VLC nightly build, there is no need to install vlc-devel packages.

==MPlayer Phonon backend==

 * Dependencies
   * Same as above +
   * MPlayer: >= MPlayer-1.0rc2
      * Website: http://www.mplayerhq.hu/
      * Developers infos: http://www.mplayerhq.hu/DOCS/tech/slave.txt
      * Download link: http://www.mplayerhq.hu/design7/dload.html

MPlayer Phonon backend runs the MPlayer (mplayer.exe under Windows) process in slave mode.

 * Under GNU/Linux, you should get a MPlayer package with your favorite GNU/Linux distribution

 * Under Windows, install [http://smplayer.sourceforge.net/ SMPlayer] that comes with a Windows build of MPlayer. phonon-mplayer looks for {{{C:/Program Files/SMPlayer/mplayer/mplayer.exe}}}, I have to improve this code, if you have some ideas please tell me.

=Get the source code=

 * Linux
You need to install [http://subversion.tigris.org/ Subversion], and then enter this command line:
{{{svn co http://phonon-vlc-mplayer.googlecode.com/svn/ phonon-vlc-mplayer}}}

 * Windows
Under Windows, I recommend to install [http://tortoisesvn.tigris.org/ TortoiseSVN].
Then right click on an empty directory and select {{{SVN Checkout...}}} and enter {{{http://phonon-vlc-mplayer.googlecode.com/svn/}}}

http://phonon-vlc-mplayer.googlegroups.com/web/phonon-vlc-mplayer-tortoisesvn.png?gda=2qH30VMAAADzGcJ2Wp_dML5pKvawJMYJk78pZsf9cl0k95O_fFnkOmG1qiJ7UbTIup-M2XPURDTf-EQHMgtRDQmqKfqDX3niD-A81HbH9qxuvAXiTpBThAKOZFcal87Qff7gkugrF_g&gsc=-sR1VgsAAABMDwMWexEhpE3I217pOobO

=How to build=

 * Under GNU/Linux:
{{{
cd trunk
cd build
./build_make-debug.sh
make
make install
}}}

 * Under Windows:
{{{
cd trunk
cd build
build_nmake-debug.bat
nmake
nmake install
}}}

For generating a Visual C++ 2005 project, there is {{{build/build_projectmsvc8-debug.bat}}}, however I recommend the process above.

=Run the Phonon backends=

Qt looks for a specific location where Phonon .(dll|so) plugins are installed. Qt will load the first plugin found from this location.
Check Qt Plugins !HowTo: http://doc.trolltech.com/main-snapshot/plugins-howto.html

KDE allows you to configure the Phonon backend you want to use via the command {{{systemsettings}}}.
Qt comes with the program {{{qtconfig}}} under GNU/Linux that let's you configure your Phonon backend.

Currenlty, Phonon backends have to be recompiled either for KDE or for Qt, that's why you will find some KDE4_FOUND defines in phonon-vlc-mplayer code (Backend.cpp and CMakeLists.txt)

 * Under Window, Qt looks for Phonon plugins inside {{{$QTDIR/plugins/phonon_backend}}}

 * Under GNU/Linux it varies, Qt looks for {{{}}} or {{{}}}

=Use phonon-vlc-mplayer with your own Qt application=

Copy phonon-vlc.(dll|so) or phonon-mplayer.(dll|so) inside {{{MYAPP/phonon_backend/}}}
(I didn't test this but it should work)

It is not possible to do a {{{Phonon::setPreferredBackend("backend my app need")}}} inside your Qt application.

Please tell me if you encounter some problems via: phonon-vlc-mplayer@googlegroups.com
